{"version":3,"file":"lcc-ufm-percent.js","sources":["../../../Client/src/LccEditorUfmPercent.ts","../../../Client/src/LccUfmPercentElement.ts"],"sourcesContent":["import { Tokens } from '@umbraco-cms/backoffice/external/marked';\r\nimport { UmbUfmComponentBase } from '@umbraco-cms/backoffice/ufm';\r\n\r\nexport class LccEditorUfmPercent extends UmbUfmComponentBase {\r\n    render(token: Tokens.Generic) {\r\n        return '</ufm-percent><ufm-percent alias=\"' + token.text + '\"></ufm-percent><ufm-percent alias=\"!' + token.text + '\" style=\"text-decoration:line-through;\">';\r\n    }\r\n}\r\n\r\nexport { LccEditorUfmPercent as api };\r\n\r\n","import { UmbUfmElementBase } from '@umbraco-cms/backoffice/ufm';\r\nimport { customElement, property } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UMB_BLOCK_ENTRY_CONTEXT } from '@umbraco-cms/backoffice/block';\r\n\r\n@customElement('ufm-percent')\r\nexport class LccUfmPercentElement extends UmbUfmElementBase {\r\n    @property()\r\n    alias?: string;\r\n    constructor() {\r\n        super();\r\n\r\n        this.consumeContext(UMB_BLOCK_ENTRY_CONTEXT, async (entry) => {\r\n            if (entry && entry.contentValues) {\r\n                const content = await entry.contentValues();\r\n                this.observe(\r\n                    content,\r\n                    (value) => {\r\n                        this.value = '';\r\n                        if (this.alias !== undefined && value !== undefined && typeof value === 'object' && Object.keys(value).length > 0) {\r\n                            let enable = (value as Record<string, unknown>)['enable'];\r\n                            let compare = this.alias.charAt(0) != '!';\r\n                            if ((compare === true && enable !== false) || (compare === false && enable === false)) {\r\n                                let obj: any = value;\r\n                                let fields = this.alias.replace('!', '').replace('[', '.').replace(']', '').split('.');\r\n                                for (let i = 0; i != fields.length; i++) {\r\n                                    let field = fields[i];\r\n                                    let num = Number(field);\r\n                                    if (isNaN(num)) {\r\n                                        if (typeof obj === 'object' && Object.keys(obj).some(k => k == field) == true) {\r\n                                            obj = (obj as Record<string, unknown>)[field];\r\n                                        } else {\r\n                                            console.log('ERROR in Ufm ' + this.alias + ': ' + field + ' doesn\\'t exist in ' + JSON.stringify(obj));\r\n                                        }\r\n                                    } else {\r\n                                        if (Array.isArray(obj)) {\r\n                                            let array = (obj as Array<unknown>);\r\n                                            if (num < array.length) {\r\n                                                obj = array[num];\r\n                                            } else {\r\n                                                console.log('ERROR in Ufm ' + this.alias + ': Array doesn\\'t have ' + num + ' elements');\r\n                                            }\r\n                                        } else {\r\n                                            console.log('ERROR in Ufm ' + this.alias + ': Not an array in ' + JSON.stringify(obj));\r\n                                        }\r\n                                    }\r\n                                }\r\n                                if (Array.isArray(obj)) {\r\n                                    obj = (obj as Array<unknown>)[0];\r\n                                }\r\n                                if (typeof obj === 'object') {\r\n                                    if (Object.keys(obj).some(k => k == 'text') == true) {\r\n                                        obj = (obj as Record<string, unknown>)['text'];\r\n                                    }\r\n\r\n                                    if (Object.keys(obj).some(k => k == 'markup') == true) {\r\n                                        let html = (obj as Record<string, unknown>)['markup'] as string;\r\n                                        let children = (new DOMParser().parseFromString(html, 'text/html')).body.childNodes;\r\n                                        for (let i = 0; i != children.length; i++) {\r\n                                            let text = children[i].textContent?.trim();\r\n                                            if (typeof text === 'string' && text !== '') {\r\n                                                if (text.length > 30) {\r\n                                                    this.value = text.substring(0, 30) + '...';\r\n                                                } else {\r\n                                                    this.value = text;\r\n                                                }\r\n                                                break;\r\n                                            }\r\n                                        }\r\n                                    }\r\n                                } else {\r\n                                    this.value = obj;\r\n                                }\r\n                            }\r\n                        }\r\n                    },\r\n                    'observeValue'\r\n                );\r\n            }\r\n        });\r\n    }\r\n}\r\n\r\nexport { LccUfmPercentElement as element };\r\n\r\ndeclare global {\r\n    interface HTMLElementTagNameMap {\r\n        ['ufm-percent']: LccUfmPercentElement;\r\n    }\r\n}\r\n"],"names":["LccEditorUfmPercent","UmbUfmComponentBase","token","LccUfmPercentElement","UmbUfmElementBase","UMB_BLOCK_ENTRY_CONTEXT","entry","content","value","enable","compare","obj","fields","field","num","k","array","html","children","i","text","_a","__decorateClass","property","customElement"],"mappings":";;;AAGO,MAAMA,UAA4BC,EAAoB;AAAA,EACzD,OAAOC,GAAuB;AAC1B,WAAO,uCAAuCA,EAAM,OAAO,0CAA0CA,EAAM,OAAO;AAAA,EAAA;AAE1H;;;;;;ACFa,IAAAC,IAAN,cAAmCC,EAAkB;AAAA,EAGxD,cAAc;AACJ,UAAA,GAED,KAAA,eAAeC,GAAyB,OAAOC,MAAU;AACtD,UAAAA,KAASA,EAAM,eAAe;AACxB,cAAAC,IAAU,MAAMD,EAAM,cAAc;AACrC,aAAA;AAAA,UACDC;AAAA,UACA,CAACC,MAAU;;AAEP,gBADA,KAAK,QAAQ,IACT,KAAK,UAAU,UAAaA,MAAU,UAAa,OAAOA,KAAU,YAAY,OAAO,KAAKA,CAAK,EAAE,SAAS,GAAG;AAC3G,kBAAAC,IAAUD,EAAkC,QAC5CE,IAAU,KAAK,MAAM,OAAO,CAAC,KAAK;AACtC,kBAAKA,MAAY,MAAQD,MAAW,MAAWC,MAAY,MAASD,MAAW,IAAQ;AACnF,oBAAIE,IAAWH,GACXI,IAAS,KAAK,MAAM,QAAQ,KAAK,EAAE,EAAE,QAAQ,KAAK,GAAG,EAAE,QAAQ,KAAK,EAAE,EAAE,MAAM,GAAG;AACrF,yBAAS,IAAI,GAAG,KAAKA,EAAO,QAAQ,KAAK;AACjC,sBAAAC,IAAQD,EAAO,CAAC,GAChBE,IAAM,OAAOD,CAAK;AAClB,sBAAA,MAAMC,CAAG;AACT,oBAAI,OAAOH,KAAQ,YAAY,OAAO,KAAKA,CAAG,EAAE,KAAK,CAAKI,MAAAA,KAAKF,CAAK,KAAK,KACrEF,IAAOA,EAAgCE,CAAK,IAEpC,QAAA,IAAI,kBAAkB,KAAK,QAAQ,OAAOA,IAAQ,uBAAwB,KAAK,UAAUF,CAAG,CAAC;AAAA,2BAGrG,MAAM,QAAQA,CAAG,GAAG;AACpB,wBAAIK,IAASL;AACT,oBAAAG,IAAME,EAAM,SACZL,IAAMK,EAAMF,CAAG,IAEf,QAAQ,IAAI,kBAAkB,KAAK,QAAQ,0BAA2BA,IAAM,WAAW;AAAA,kBAC3F;AAEQ,4BAAA,IAAI,kBAAkB,KAAK,QAAQ,uBAAuB,KAAK,UAAUH,CAAG,CAAC;AAAA,gBAE7F;AAKA,oBAHA,MAAM,QAAQA,CAAG,MACjBA,IAAOA,EAAuB,CAAC,IAE/B,OAAOA,KAAQ;AAKX,sBAJA,OAAO,KAAKA,CAAG,EAAE,KAAK,CAAKI,MAAAA,KAAK,MAAM,KAAK,OAC3CJ,IAAOA,EAAgC,OAGvC,OAAO,KAAKA,CAAG,EAAE,KAAK,CAAKI,MAAAA,KAAK,QAAQ,KAAK,IAAM;AAC/C,wBAAAE,IAAQN,EAAgC,QACxCO,IAAY,IAAI,YAAY,gBAAgBD,GAAM,WAAW,EAAG,KAAK;AACzE,6BAASE,IAAI,GAAGA,KAAKD,EAAS,QAAQC,KAAK;AACvC,0BAAIC,KAAOC,IAAAH,EAASC,CAAC,EAAE,gBAAZ,gBAAAE,EAAyB;AACpC,0BAAI,OAAOD,KAAS,YAAYA,MAAS,IAAI;AACrC,wBAAAA,EAAK,SAAS,KACd,KAAK,QAAQA,EAAK,UAAU,GAAG,EAAE,IAAI,QAErC,KAAK,QAAQA;AAEjB;AAAA,sBAAA;AAAA,oBACJ;AAAA,kBACJ;AAAA;AAGJ,uBAAK,QAAQT;AAAA,cACjB;AAAA,YACJ;AAAA,UAER;AAAA,UACA;AAAA,QACJ;AAAA,MAAA;AAAA,IACJ,CACH;AAAA,EAAA;AAET;AAzEIW,EAAA;AAAA,EADCC,EAAS;AAAA,GADDpB,EAET,WAAA,SAAA,CAAA;AAFSA,IAANmB,EAAA;AAAA,EADNE,EAAc,aAAa;AAAA,GACfrB,CAAA;"}