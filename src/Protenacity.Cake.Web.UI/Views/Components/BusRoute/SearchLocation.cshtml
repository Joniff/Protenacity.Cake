@model Protenacity.Cake.Web.Presentation.Editor.BusRoute.BusRouteViewModel

<div class="w-100">
    <theme subtheme="Model.Subtheme" shade="Model.ThemeShade" border-color="@Model.BorderColor" border-edges="@Model.BorderEdges" class="w-100">

        <vc:paging render="@PageRenders.SearchBox" model="Model"></vc:paging>

        @if (Model.Criteria != null)
        {
            <div class="mb-3 mt-3">
                @if (Model.Result?.Features?.Any() == true)
                {
                    <h3>
                        Results @((Model.Page * Model.PageSize) + 1) @(Model.Result?.Features.Count() > 1 ? "to " + ((Model.Page * Model.PageSize) + Model.Result?.Features.Count()) : null) of @(Model.TotalResults)
                    </h3>
                    <div>
                        @if (Model.Result?.Features?.Any(p => p.Attribute?.Postcode != null) == true)
                        {
                            @foreach (var result in Model.Result!.Features.GroupBy(p => p.Attribute?.Postcode).OrderBy(p => p.Key))
                            {
                                <a class="row mt-3 mb-3 link-offset-2 link-underline link-underline-opacity-0" href="@(Model.LinkUrl)?@(Protenacity.Cake.Web.Presentation.Editor.BusRoute.BusRouteViewComponent.QueryString)=@(HttpUtility.HtmlEncode(result.Key))">
                                    <div class="col">
                                        @result.Key
                                    </div>
                                </a>
                            }
                        }
                        else if (Model.Result?.Features?.Any(p => p.Attribute?.Address1 != null) == true)
                        {
                            @foreach (var result in Model.Result!.Features.GroupBy(p => p.Attribute?.Address1.ToTitleCase() + ", " + p.Attribute?.Address2.ToTitleCase()).OrderBy(p => p.Key))
                            {
                                <a class="row mt-3 mb-3 link-offset-2 link-underline link-underline-opacity-0" href="@(Model.LinkUrl)?@(Protenacity.Cake.Web.Presentation.Editor.BusRoute.BusRouteViewComponent.QueryString)=@(HttpUtility.HtmlEncode(result.Key))">
                                    <div class="col">
                                        @result.Key
                                    </div>
                                    @*
                                    <div class="col">
                                        @result.FirstOrDefault()?.Attribute?.Locality.ToTitleCase(), @result.FirstOrDefault()?.Attribute?.District.ToTitleCase()
                                    </div>
                                    *@
                                </a>
                            }
                        }
                        else
                        {
                            @foreach (var result in Model.Result!.Features.GroupBy(p => p.Attribute?.Locality.ToTitleCase() + ", " + p.Attribute?.District.ToTitleCase()).OrderBy(p => p.Key))
                            {
                                <a class="row mt-3 mb-3 link-offset-2 link-underline link-underline-opacity-0" href="@(Model.LinkUrl)?@(Protenacity.Cake.Web.Presentation.Editor.BusRoute.BusRouteViewComponent.QueryString)=@(HttpUtility.HtmlEncode(result.Key))">
                                    <div class="col">
                                        @result.Key
                                    </div>
                                </a>
                            }
                        }
                    </div>

                    <vc:paging render="@PageRenders.Paging" model="Model"></vc:paging>
                }
                else
                {
                    <h3>
                        No Results
                    </h3>
                }
            </div>
        }
    </theme>
</div>


